# Containerfile.web: Web Portal (React + Three.js)
FROM node:18

# Set working directory
WORKDIR /app


# Copy package.json and package-lock.json, install dependencies
COPY web_portal/package.json ./
COPY web_portal/package-lock.json ./
RUN npm install

# Copy web portal source code (will be overridden by volume mount if present)
COPY web_portal/ ./

# Expose port for development server
EXPOSE 3000

# Create a startup script that always installs dependencies for volume-mounted code
RUN echo '#!/bin/bash\n\
if [ -f /app/web_portal/package.json ]; then\n\
    echo "Using volume-mounted web portal"\n\
    cd /app/web_portal\n\
    npm install\n\
    exec npm start "$@"\n\
else\n\
    echo "Using built-in web portal"\n\
    npm install\n\
    exec npm start "$@"\n\
fi\n' > /app/start.sh && \
    chmod +x /app/start.sh

# Entrypoint for React app
CMD ["/app/start.sh"]
